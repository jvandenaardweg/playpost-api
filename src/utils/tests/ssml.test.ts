import { AWS_CHARACTER_HARD_LIMIT, AWS_CHARACTER_SOFT_LIMIT, getSSMLParts, GOOGLE_CHARACTER_HARD_LIMIT, GOOGLE_CHARACTER_SOFT_LIMIT } from '../ssml';

describe('ssml', () => {

  describe('getSSMLParts()', () => {

    it('Should generate one SSML part if it stays below the character limit.', () => {
      const exampleSsml = '<speak><p>A paragraph to be spoken.</p><p>And another one.</p></speak>';
      const expected = '<speak><p>A paragraph to be spoken.</p><p>And another one.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml);

      expect(ssmlParts).toHaveLength(1);
      expect(ssmlParts[0]).toBe(expected);
    });

    it('Should generate 2 SSML parts if it goes over the character limit.', () => {
      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ornare posuere massa in convallis.</p><break time="500ms" /><p>Integer volutpat sem in mollis egestas. Morbi rutrum ante a imperdiet interdum. Sed velit arcu, viverra sed nulla sit amet, auctor egestas dolor.</p><p>Cras interdum pulvinar posuere. Pellentesque mollis consectetur elit, vitae iaculis nibh dapibus vel. Duis maximus fringilla magna ac fermentum. Vestibulum porttitor eros tellus, a fermentum leo bibendum pellentesque. Mauris semper fringilla mauris, non fringilla velit dictum sed.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ornare posuere massa in convallis.</p><break time=\"500ms\" /><p>Integer volutpat sem in mollis egestas. Morbi rutrum ante a imperdiet interdum. Sed velit arcu, viverra sed nulla sit amet, auctor egestas dolor.</p></speak>';
      const expectedSecondPart = '<speak><p>Cras interdum pulvinar posuere. Pellentesque mollis consectetur elit, vitae iaculis nibh dapibus vel. Duis maximus fringilla magna ac fermentum. Vestibulum porttitor eros tellus, a fermentum leo bibendum pellentesque. Mauris semper fringilla mauris, non fringilla velit dictum sed.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: 500,
        softLimit: 200
      });

      expect(ssmlParts).toHaveLength(2);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[1]).toBe(expectedSecondPart);
    });

    it('Should generate the correct SSML parts for the Google Text-To-Speech API.', () => {

      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p></speak>';
      const expectedSecondPart = '<speak><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: GOOGLE_CHARACTER_HARD_LIMIT,
        softLimit: GOOGLE_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(2);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[0]).toHaveLength(4531);
      expect(ssmlParts[1]).toBe(expectedSecondPart);
      expect(ssmlParts[1]).toHaveLength(2748);
    });

    it('Should generate the correct SSML parts for AWS Polly.', () => {

      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p></speak>';
      const expectedSecondPart = '<speak><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p></speak>';
      const expectedThirdPart = '<speak><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: AWS_CHARACTER_HARD_LIMIT,
        softLimit: AWS_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(4);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[0]).toHaveLength(1742);
      expect(ssmlParts[1]).toBe(expectedSecondPart);
      expect(ssmlParts[1]).toHaveLength(2096);
      expect(ssmlParts[2]).toBe(expectedThirdPart);
      expect(ssmlParts[2]).toHaveLength(2229);
    });

    it('Should generate the correct SSML parts for AWS Polly when using a very long SSML tag.', () => {
      // tslint:disable max-line-length
      const largeExample = '<speak><p>Goodbye Dollar, It Was Nice Knowing You!.</p><break time="500ms" /><p>Over the past two years, the White House has initiated trade disputes, insulted allies and enemies alike, and withdrawn from or refused to ratify multinational treaties and agreements. It has also expanded the reach of its unilaterally imposed rules, forcing other nations to abide by its demands or face economic sanctions. While the stated Trump Administration intention has been to enter into new arrangements more favorable to the United States, the end result has been quite different, creating a broad consensus within the international community that Washington is unstable, not a reliable partner and cannot be trusted. This sentiment has, in turn, resulted in conversations among foreign governments regarding how to circumvent the American banking system, which is the primary offensive weapon apart from dropping bombs that Washington has to force compliance with its dictates.</p><p>Consequently, there has been considerable blowback from the Make America Great Again campaign, particularly as the flip side of the coin appears to be that the “greatness” will be obtained by making everyone else less great. The only country in the world that currently regards the United States favorably is Israel, which certainly has good reason to do so given the largesse that has come from the Trump Administration. Everyone else is keen to get out from under the American heel.</p><p>Well the worm has finally turned, maybe. Even the feckless Angela Merkel’s Germany now understands that national interests must prevail when the United States is demanding that it do the unspeakable. At the recently concluded G20 meeting in Tokyo Britain, France and Germany announced that the special trade mechanism that they have been working on this year is now up and running. It is called the Instrument in Support of Trade Exchanges (Instex) and it will permit companies in Europe to do business with countries like Iran, avoiding American sanctions by trading outside the SWIFT system, which is dollar denominated and de facto controlled by the US Treasury.</p><p>The significance of the European move cannot be understated. It is the first major step in moving away from the dominance of the dollar as the world’s trading and reserve currency. As is often the case, the damage to US perceived interests is self-inflicted. There has been talk for years regarding setting up trade mechanisms that would not be dollar based, but they did not gain any momentum until the Trump Administration abruptly withdrew from the Joint Comprehensive Plan of Action (JCPOA) with Iran over a year ago.</p><p>There were other signatories to the JCPOA, all of whom were angered by the White House move, because they believed correctly that it was a good agreement, preventing Iranian development of a nuclear weapon while also easing tensions in the Middle East. Major European powers Germany, France and Great Britain, as well as Russia and China, were all signatories and the agreement was endorsed by the United Nations Security Council. The US withdrawal in an attempt to destroy the “plan of action” was therefore viewed extremely negatively by all the other signatories and their anger increased when Washington declared that it would reinstate sanctions on Iran and also use secondary sanctions to punish any third party that did not comply with the restrictions on trade.</p><p>Instex is an upgrade of a previous “Special Purpose Vehicle” set up by the Europeans a year ago to permit trading with Iran without any actual money transfers, something like a barter system based on balancing payments by value. The announcement regarding Instex came as a result of last week’s meeting in Vienna in which the JCPOA signatories minus the US got together with Iranian ministry spokesman Abbas Mousavi, who called the gathering “the last chance for the remaining parties…to gather and see how they can meet their commitments towards Iran.”</p><p>Iran is quietly pleased by the development, even though there are critics of the arrangement and the government is officially declaring that Instex is not enough and it will proceed with plans to increase its uranium production. This produced an immediate response from Secretary of State Mike Pompeo last week speaking in New Delhi “If there is conflict, if there is war, if there is a kinetic activity, it will be because the Iranians made that choice.” Nevertheless, Instex could possibly be a model for mechanisms that will allow Iran to sell its oil without hindrance from Washington. But a sharp reaction from the White House is expected. While Instex was in the development phase, US observers noted that the Iranian Special Trade and Finance Instrument, that will do the actual trading, includes government agencies that are already under US sanctions. That likely means that Washington will resort to secondary sanctions on the Europeans, a move that will definitely make the bilateral relationship even more poisonous than it already is. A global trade war is a distinct possibility and, as observed above, the abandonment of the dollar as the international reserve currency is a possible consequence.</p><p>Trump has already been “threatening penalties against the financial body created by Germany, the U.K. and France to shield trade with the Islamic Republic from US sanctions.” The Treasury’s undersecretary for terrorism and financial intelligence, Israeli Sigal Mandelker, warned in a May 7th letter that “I urge you to carefully consider the potential sanctions exposure of Instex. Engaging in activities that run afoul of US sanctions can result in severe consequences, including a loss of access to the US financial system.”</p><p>Indeed, the White House appears to be willing to engage in economic warfare with Europe over the issue of punishing Iran. The Treasury Department issued a statement regarding the Mandelker letter, saying “entities that transact in trade with the Iranian regime through any means may expose themselves to considerable sanctions risk, and Treasury intends to aggressively enforce our authorities.” Mike Pompeo also was explicit during a visit to London on May 8th when he stated that “…it doesn’t matter what vehicle’s out there, if the transaction is sanctionable, we will evaluate it, review it, and if appropriate, levy sanctions against those that were involved in that transaction. It’s very straightforward.”</p><p>It is perhaps not unreasonable to wish the Europeans success, as they are supporting free trade while also registering their opposition to the White House’s bullying tactics using the world financial system. And if the dollar ceases to be the world’s trade and reserve currency, what of it? It would mean that the Treasury might have to cease printing surplus dollars and the US ability to establish global hegemony on a credit card might well be impeded. Those would be good results and one might also hope that some day soon the United States might once again become a normal country that Americans would be proud to call home.</p></speak>';

      const ssmlParts = getSSMLParts(largeExample, {
        hardLimit: AWS_CHARACTER_HARD_LIMIT,
        softLimit: AWS_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(4);
    });
  });

});
