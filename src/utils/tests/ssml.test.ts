import { AWS_CHARACTER_HARD_LIMIT, AWS_CHARACTER_SOFT_LIMIT, getSSMLParts, GOOGLE_CHARACTER_HARD_LIMIT, GOOGLE_CHARACTER_SOFT_LIMIT } from '../ssml';

describe('ssml', () => {

  describe('getSSMLParts()', () => {

    it('Should generate one SSML part if it stays below the character limit.', () => {
      const exampleSsml = '<speak><p>A paragraph to be spoken.</p><p>And another one.</p></speak>';
      const expected = '<speak><p>A paragraph to be spoken.</p><p>And another one.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml);

      expect(ssmlParts).toHaveLength(1);
      expect(ssmlParts[0]).toBe(expected);
    });

    it('Should generate 2 SSML parts if it goes over the character limit.', () => {
      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ornare posuere massa in convallis.</p><break time="500ms" /><p>Integer volutpat sem in mollis egestas. Morbi rutrum ante a imperdiet interdum. Sed velit arcu, viverra sed nulla sit amet, auctor egestas dolor.</p><p>Cras interdum pulvinar posuere. Pellentesque mollis consectetur elit, vitae iaculis nibh dapibus vel. Duis maximus fringilla magna ac fermentum. Vestibulum porttitor eros tellus, a fermentum leo bibendum pellentesque. Mauris semper fringilla mauris, non fringilla velit dictum sed.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ornare posuere massa in convallis.</p><break time=\"500ms\" /><p>Integer volutpat sem in mollis egestas. Morbi rutrum ante a imperdiet interdum. Sed velit arcu, viverra sed nulla sit amet, auctor egestas dolor.</p></speak>';
      const expectedSecondPart = '<speak><p>Cras interdum pulvinar posuere. Pellentesque mollis consectetur elit, vitae iaculis nibh dapibus vel. Duis maximus fringilla magna ac fermentum. Vestibulum porttitor eros tellus, a fermentum leo bibendum pellentesque. Mauris semper fringilla mauris, non fringilla velit dictum sed.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: 500,
        softLimit: 200
      });

      expect(ssmlParts).toHaveLength(2);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[1]).toBe(expectedSecondPart);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(500);
      })
    });

    it('Should generate the correct SSML parts for the Google Text-To-Speech API.', () => {

      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p></speak>';
      const expectedSecondPart = '<speak><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: GOOGLE_CHARACTER_HARD_LIMIT,
        softLimit: GOOGLE_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(2);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[0]).toHaveLength(3823);
      expect(ssmlParts[1]).toBe(expectedSecondPart);
      expect(ssmlParts[1]).toHaveLength(3456);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(GOOGLE_CHARACTER_HARD_LIMIT);
      })
    });

    it('Should generate the correct SSML parts for AWS Polly.', () => {

      // tslint:disable max-line-length
      const exampleSsml = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p><p>Vestibulum faucibus ultrices suscipit. Sed lacinia nunc vel lorem facilisis auctor. Nulla facilisi. Nam pretium egestas ligula at efficitur. Sed ut mauris ut mi blandit luctus. Fusce tristique pharetra felis non fermentum. Sed rhoncus fringilla semper. Maecenas suscipit euismod magna pretium vehicula. Duis iaculis pulvinar luctus. Nulla fermentum vulputate nisi in molestie. Suspendisse a urna laoreet, tincidunt lorem nec, accumsan ligula. Pellentesque a quam eu velit scelerisque varius. Nullam quis mollis libero. Maecenas sodales ac leo at auctor. In dapibus commodo magna sit amet sollicitudin. Quisque molestie auctor nunc vitae ornare.</p><p>Vestibulum malesuada non lectus vitae suscipit. Maecenas vel cursus diam. Nunc at malesuada ante. Curabitur facilisis nisl nec dolor tempor, quis tempor lorem pharetra. Morbi pretium, dolor eu tincidunt vestibulum, ligula diam interdum eros, tempor suscipit nulla metus nec enim. Suspendisse id sem mi. Nunc vitae dui ultricies, convallis nunc quis, aliquam tellus. Maecenas at odio eu est semper maximus. Vivamus nec lorem erat. Mauris tempor luctus erat id elementum. Maecenas dictum ex in eros porttitor, eu lobortis nisi pretium. Duis porta vitae dolor quis auctor.</p></speak>';

      const expectedFirstPart = '<speak><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam eget neque id orci lobortis dignissim et in augue. Fusce pulvinar, enim non dictum laoreet, lacus purus placerat lacus, non dictum leo nibh at felis. Phasellus convallis, tellus nec pharetra lacinia, nisi nisl ornare enim, ut porttitor urna quam mollis nisl. Maecenas malesuada risus a ornare lacinia. In eleifend vehicula ipsum, at ultrices dui ultricies ut. Maecenas in finibus enim, nec gravida enim. Proin semper varius nisi. Aenean auctor finibus metus eu cursus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In sed sollicitudin nibh, nec pharetra dolor. Vestibulum molestie nunc in arcu condimentum scelerisque. Curabitur quam eros, dictum eu enim in, vulputate dictum tellus. Duis sed pulvinar urna, nec pharetra sem. Donec volutpat, augue vel dictum vehicula, nisi justo iaculis velit, in tincidunt dolor lorem in est.</p><p>Aenean vitae sollicitudin justo. Morbi sapien leo, dictum quis aliquam nec, egestas quis nulla. Duis semper dui leo. Aenean non malesuada nisl. Aenean semper quam velit. Praesent a elit lectus. Nulla ac justo consectetur, auctor leo eu, ultricies sapien. Curabitur in efficitur urna. Vestibulum efficitur orci quis justo iaculis, et ullamcorper turpis fringilla. Pellentesque est diam, varius sed mollis eu, vulputate scelerisque odio. Proin tincidunt elementum tortor a ornare. Nulla vel orci in diam mattis aliquam molestie et libero. Integer accumsan mi justo, vitae viverra odio rutrum eu. Praesent eu tellus mollis, interdum odio a, pulvinar mi. Fusce nibh felis, euismod ac felis quis, ornare porta magna. Integer ipsum felis, faucibus ac auctor bibendum, malesuada non est.</p></speak>';
      const expectedSecondPart = '<speak><p>Pellentesque consequat mi vitae nisi pellentesque, a dapibus sapien tempor. Donec sit amet efficitur sapien. Fusce libero arcu, luctus ut maximus eu, tempor ut nunc. Nam vitae metus nunc. Nam tempus a eros vel facilisis. Aliquam sit amet mollis arcu. Praesent sollicitudin, mauris a lacinia malesuada, sem eros tempus lectus, hendrerit volutpat mauris mi nec lorem. Praesent ac porttitor massa. In tincidunt augue libero, nec luctus leo placerat eu. Pellentesque ultrices nisl urna, et ullamcorper metus pulvinar vel. Suspendisse potenti. Donec molestie vestibulum diam, vel lacinia odio dapibus quis. Vivamus efficitur, ligula quis facilisis feugiat, erat risus interdum sapien, sit amet tristique nibh enim sit amet velit. Vestibulum a malesuada ipsum, vel pharetra elit.</p><p>Donec et metus ac leo mattis vestibulum non nec orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus nunc, fringilla eu consectetur sit amet, rhoncus sed ipsum. Sed malesuada odio nec nibh facilisis eleifend. Mauris laoreet feugiat odio. Morbi cursus nunc nec nulla tincidunt, in consectetur felis bibendum. Nam malesuada maximus urna, nec tristique enim tincidunt at. Nunc sagittis lorem vel metus molestie, sed iaculis mauris ornare. Sed et metus nulla. Sed at enim quis ligula blandit consequat sed eget ligula. Proin quis pretium dui.</p><p>Sed malesuada dui id odio hendrerit laoreet. Maecenas dolor elit, fringilla nec tincidunt a, ultrices eget urna. Aenean porttitor est quis purus condimentum tincidunt eget sit amet purus. In consectetur, sem vel congue pretium, magna ipsum imperdiet nisl, eu suscipit tortor est sit amet dolor. Sed elit velit, lobortis eu diam vitae, accumsan mollis ligula. Nam mauris ipsum, lacinia in ex dignissim, consequat posuere ex. Nullam sollicitudin sapien quis blandit facilisis. Duis sodales hendrerit dolor nec pharetra. Sed imperdiet sem eget sem posuere, a porttitor felis blandit. Proin rhoncus vestibulum diam in porttitor. Interdum et malesuada fames ac ante ipsum primis in faucibus.</p></speak>';
      const expectedThirdPart = '<speak><p>Nunc vitae urna sed urna luctus vulputate non ut lorem. Maecenas lobortis nisl eget varius sollicitudin. Nunc sagittis pharetra eros. Integer consectetur scelerisque vulputate. Nulla sed nibh vel urna auctor convallis. Vestibulum a nisi ac sem egestas efficitur in convallis augue. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras auctor enim ac dui ultrices porta. Nam auctor suscipit felis eget vestibulum. Aenean a ipsum vitae enim fringilla aliquet. Donec malesuada elit a egestas ultricies. Fusce sed ex posuere purus commodo consequat. Sed imperdiet tristique ultricies. Cras consequat nisi ut urna vestibulum iaculis. Nam laoreet euismod maximus.</p><p>Sed viverra, magna vitae aliquet faucibus, lacus turpis tristique turpis, eu convallis quam nibh a nisi. In viverra tempus ullamcorper. Quisque sollicitudin vehicula urna, lacinia bibendum felis pulvinar eu. Pellentesque feugiat vehicula nunc, vitae bibendum erat. Curabitur eu felis et augue hendrerit laoreet. Ut et aliquet dolor, eu facilisis justo. Pellentesque elementum iaculis nulla vitae ornare. Integer volutpat, turpis eu placerat fermentum, erat diam tincidunt lacus, ut consequat arcu ex vel ipsum. Fusce nec quam molestie, laoreet elit ut, dictum nulla. Nulla fringilla facilisis accumsan. Sed nisi sem, ornare at cursus accumsan, vehicula vel augue. Cras semper feugiat ex, ac commodo felis rhoncus non.</p><p>Pellentesque pharetra pharetra dictum. Ut urna justo, tristique et ipsum at, sodales gravida tellus. Morbi vitae cursus orci. Ut id dui quis enim blandit egestas. Quisque euismod varius eros, vel tincidunt purus venenatis eu. Praesent tempor, ex at consectetur sodales, nisi erat pharetra sapien, quis ultrices sem leo a ex. Sed et eros fermentum, porttitor mauris a, elementum elit. Etiam a sagittis urna. Nunc ac risus ullamcorper, tincidunt erat eu, efficitur elit. Integer sapien elit, vehicula eu justo in, interdum congue est. Vestibulum id sem a ipsum faucibus posuere. Mauris vel blandit ligula, vel vehicula quam. Curabitur turpis purus, efficitur id varius ac, hendrerit sed nunc. Phasellus quis iaculis massa. Donec nec dui sed ante elementum interdum sed ac quam.</p></speak>';

      const ssmlParts = getSSMLParts(exampleSsml, {
        hardLimit: AWS_CHARACTER_HARD_LIMIT,
        softLimit: AWS_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(4);
      expect(ssmlParts[0]).toBe(expectedFirstPart);
      expect(ssmlParts[0]).toHaveLength(1742);
      expect(ssmlParts[1]).toBe(expectedSecondPart);
      expect(ssmlParts[1]).toHaveLength(2096);
      expect(ssmlParts[2]).toBe(expectedThirdPart);
      expect(ssmlParts[2]).toHaveLength(2229);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(AWS_CHARACTER_HARD_LIMIT);
      })
    });

    it('Should generate the correct SSML parts for AWS Polly when using a very long SSML tag.', () => {
      // tslint:disable max-line-length
      const largeExample = '<speak><p>Goodbye Dollar, It Was Nice Knowing You!.</p><break time="500ms" /><p>Over the past two years, the White House has initiated trade disputes, insulted allies and enemies alike, and withdrawn from or refused to ratify multinational treaties and agreements. It has also expanded the reach of its unilaterally imposed rules, forcing other nations to abide by its demands or face economic sanctions. While the stated Trump Administration intention has been to enter into new arrangements more favorable to the United States, the end result has been quite different, creating a broad consensus within the international community that Washington is unstable, not a reliable partner and cannot be trusted. This sentiment has, in turn, resulted in conversations among foreign governments regarding how to circumvent the American banking system, which is the primary offensive weapon apart from dropping bombs that Washington has to force compliance with its dictates.</p><p>Consequently, there has been considerable blowback from the Make America Great Again campaign, particularly as the flip side of the coin appears to be that the “greatness” will be obtained by making everyone else less great. The only country in the world that currently regards the United States favorably is Israel, which certainly has good reason to do so given the largesse that has come from the Trump Administration. Everyone else is keen to get out from under the American heel.</p><p>Well the worm has finally turned, maybe. Even the feckless Angela Merkel’s Germany now understands that national interests must prevail when the United States is demanding that it do the unspeakable. At the recently concluded G20 meeting in Tokyo Britain, France and Germany announced that the special trade mechanism that they have been working on this year is now up and running. It is called the Instrument in Support of Trade Exchanges (Instex) and it will permit companies in Europe to do business with countries like Iran, avoiding American sanctions by trading outside the SWIFT system, which is dollar denominated and de facto controlled by the US Treasury.</p><p>The significance of the European move cannot be understated. It is the first major step in moving away from the dominance of the dollar as the world’s trading and reserve currency. As is often the case, the damage to US perceived interests is self-inflicted. There has been talk for years regarding setting up trade mechanisms that would not be dollar based, but they did not gain any momentum until the Trump Administration abruptly withdrew from the Joint Comprehensive Plan of Action (JCPOA) with Iran over a year ago.</p><p>There were other signatories to the JCPOA, all of whom were angered by the White House move, because they believed correctly that it was a good agreement, preventing Iranian development of a nuclear weapon while also easing tensions in the Middle East. Major European powers Germany, France and Great Britain, as well as Russia and China, were all signatories and the agreement was endorsed by the United Nations Security Council. The US withdrawal in an attempt to destroy the “plan of action” was therefore viewed extremely negatively by all the other signatories and their anger increased when Washington declared that it would reinstate sanctions on Iran and also use secondary sanctions to punish any third party that did not comply with the restrictions on trade.</p><p>Instex is an upgrade of a previous “Special Purpose Vehicle” set up by the Europeans a year ago to permit trading with Iran without any actual money transfers, something like a barter system based on balancing payments by value. The announcement regarding Instex came as a result of last week’s meeting in Vienna in which the JCPOA signatories minus the US got together with Iranian ministry spokesman Abbas Mousavi, who called the gathering “the last chance for the remaining parties…to gather and see how they can meet their commitments towards Iran.”</p><p>Iran is quietly pleased by the development, even though there are critics of the arrangement and the government is officially declaring that Instex is not enough and it will proceed with plans to increase its uranium production. This produced an immediate response from Secretary of State Mike Pompeo last week speaking in New Delhi “If there is conflict, if there is war, if there is a kinetic activity, it will be because the Iranians made that choice.” Nevertheless, Instex could possibly be a model for mechanisms that will allow Iran to sell its oil without hindrance from Washington. But a sharp reaction from the White House is expected. While Instex was in the development phase, US observers noted that the Iranian Special Trade and Finance Instrument, that will do the actual trading, includes government agencies that are already under US sanctions. That likely means that Washington will resort to secondary sanctions on the Europeans, a move that will definitely make the bilateral relationship even more poisonous than it already is. A global trade war is a distinct possibility and, as observed above, the abandonment of the dollar as the international reserve currency is a possible consequence.</p><p>Trump has already been “threatening penalties against the financial body created by Germany, the U.K. and France to shield trade with the Islamic Republic from US sanctions.” The Treasury’s undersecretary for terrorism and financial intelligence, Israeli Sigal Mandelker, warned in a May 7th letter that “I urge you to carefully consider the potential sanctions exposure of Instex. Engaging in activities that run afoul of US sanctions can result in severe consequences, including a loss of access to the US financial system.”</p><p>Indeed, the White House appears to be willing to engage in economic warfare with Europe over the issue of punishing Iran. The Treasury Department issued a statement regarding the Mandelker letter, saying “entities that transact in trade with the Iranian regime through any means may expose themselves to considerable sanctions risk, and Treasury intends to aggressively enforce our authorities.” Mike Pompeo also was explicit during a visit to London on May 8th when he stated that “…it doesn’t matter what vehicle’s out there, if the transaction is sanctionable, we will evaluate it, review it, and if appropriate, levy sanctions against those that were involved in that transaction. It’s very straightforward.”</p><p>It is perhaps not unreasonable to wish the Europeans success, as they are supporting free trade while also registering their opposition to the White House’s bullying tactics using the world financial system. And if the dollar ceases to be the world’s trade and reserve currency, what of it? It would mean that the Treasury might have to cease printing surplus dollars and the US ability to establish global hegemony on a credit card might well be impeded. Those would be good results and one might also hope that some day soon the United States might once again become a normal country that Americans would be proud to call home.</p></speak>';

      const ssmlParts = getSSMLParts(largeExample, {
        hardLimit: AWS_CHARACTER_HARD_LIMIT,
        softLimit: AWS_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(4);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(AWS_CHARACTER_HARD_LIMIT);
      })
    });

    it('Should generate the correct SSML parts for Google when using a very long SSML tag.', () => {
      // tslint:disable max-line-length
      const largeExample = '<speak><p><s>Beto O’Rourke’s Plan to Destroy Churches.</s><break time="1000ms" /></p><p><s>With seven words—&quot;It is going to be an issue&quot;—the U.S. government signaled to orthodox Christians that if they don’t drop their opposition to same-sex marriage, their religious institutions could lose their tax-exempt status—or worse.</s></p><p><s>Those words came in 2015, when the Supreme Court heard oral arguments inObergefell v. Hodges, the case that legalized same-sex marriage throughout the United States.</s><s>One exchangehighlighted how the ruling could affect religious liberty.</s><s>Justice Samuel Alito asked Solicitor General Donald Verrilli how it would affect educational institutions that opposed same-sex marriage:</s></p><p><s>JUSTICE ALITO: Well, in the Bob Jones case, the Court held that a college was not entitled to tax-exempt status if it opposed interracial marriage or interracial dating.</s><s>So would the same apply to a university or a college if it opposed same-sex marriage?</s></p><p><s>GENERAL VERRILLI: You know, I .</s><s>.</s><s>.</s><s>I don’t think I can answer that question without knowing more specifics, but it’s certainly going to be an issue.</s><s>I .</s><s>.</s><s>.</s><s>I don’t deny that.</s><s>I don’t deny that, Justice Alito.</s><s>It is .</s><s>.</s><s>.</s><s>it is going to be an issue.</s></p><p><s>In the 1983 case of Bob Jones University (Bob Jones University v. United States), the Supreme Court’s ruling was clear: the religious clauses of the First Amendment’s donot prohibit the IRS from revoking the tax-exempt status of a religious university whose practices contradict a compelling government public policy.</s></p><p><s>The policy at Bob Jones was indeed loathsome and contrary to Scripture, which the school later admitted when itapologized for its racist past.</s><s>But opposition to same-sex marriage is not the same as racial animus.</s><s>Yet the government, through its representative, signaled that Christian schools may soon be treated like racists and pariahs for refusing to give up the view of marriage shared by almost all people throughout history prior to the 1990s.</s></p><p><s>Start quote:</s></p><p><s>The government .</s><s>.</s><s>.</s><s>signaled that Christian schools may soon be treated like racists and pariahs for refusing to give up the view of marriage shared by almost all people throughout history prior to the 1990s.</s></p><p><s>End quote.</s></p><p><s>It’s not merely that Christian schools will have to choose between accepting federal funds and keeping their religious views about sexuality.</s><s>If the choice were to follow the example of schools likeHillsdale CollegeorNew Saint Andrews Collegeand forego taking any federal money, the decisions about what to do would be painful, but obvious.</s></p><p><s>But what it being proposed is to revoke non-profit status not only of schools but also of churches, a move that would destroy many religious institutions.</s><s>According to the IRS, if an organization’s tax-exempt status is revoked, it isno longer exempt from federal income taxand is not eligible to receive tax-deductible contributions.</s><s>As Albert Mohler, president of The Southern Baptist Theological Seminary,noted in 2015, &quot;The loss of tax-exempt status would put countless churches and religious institutions out of business, simply because the burden of property taxes and loss of charitable support would cripple their ability to sustain their mission.&quot;</s></p><p><s><break time="1000ms" />Beto Follows Obergefell Logic<break time="1000ms" /></s></p><p><s>On Thursday, during a CNN town hall devoted to LGBTQ issues, Democratic presidential candidate Beto O’Rourke was asked, &quot;Do you think religious institutions like colleges, churches, charities—should they lose their tax-exempt status if they oppose same-sex marriage?&quot;</s></p><p><s>&quot;Yes,&quot; O’Rourke said without hesitation, drawing applause from the Los Angeles audience.</s></p><p><s>&quot;There can be no reward, no benefit, no tax break for anyone—or any institution, any organization in America—that denies the full human rights and the full civil rights of every single one of us,&quot; he added.</s><s>&quot;So as president we’re going to make that a priority and we are going to stop those who are infringing on the rights of our fellow Americans.&quot;</s></p><p><s>Only four years after Obergefell, O’Rourke is showing Christians that the threat posed by legalized same-sex marriage is more real—and more radical—than they may have yet realized.</s></p><p><s><break time="1000ms" />Why Churches Should Be Exempt<break time="1000ms" /></s></p><p><s>Churches in the United States received an official federal income tax exemption in 1894, and they have been unofficially tax-exempt since the country’s founding.</s><s>All 50 states and the District of Columbia also exempt churches from paying property tax.</s><s>Changing that status would have an immediate deleterious effect on churches and pastors, many of whom are already struggling financially.</s></p><p><s>A 2015 survey by the Hartford Institute for Religion Research found that almost one in five congregations (16 percent) suffer serious financial difficulty.</s><s>Adding the burden of taxation would swiftly put them under.</s><s>Additionally, revoking tax-exempt status would likely eliminate the &quot;parsonage exemption&quot; on ministers’ housing.</s><s>This would cost American clergy members $2.3 billion over five years.</s><s>And it would be damaging to pastors who make an average salary of $39,146 a year.</s></p><p><s>Start quote:</s></p><p><s>O’Rourke is showing Christians that the threat posed by legalized same-sex marriage is more real—and more radical—than they may have yet realized.</s></p><p><s>End quote.</s></p><p><s>Yet while agreeing the policy would have a damaging effect, some Americans think the policy is reasonable.</s><s>After all, isn’t giving tax-exempt status to churches an unfair advantage?</s><s>There are two reasons it is not.</s></p><p><s>First, many people believe tax-exempt status is reserved only for churches and charities.</s><s>In reality, the IRS exempts a broad array of organizations, including labor unions, trade associations, horticultural organizations, and social clubs.</s><s>As Dimitri Cavalli haspointed out, other organizations that are tax-exempt include Americans United for the Separation of Church and State, American Atheists, American Humanist Association, Freedom from Religion Foundation, Richard Dawkins Foundation for Reason and Science, Planned Parenthood Federation of America, Secular Coalition for America Education Fund, Council for Secular Humanism, Catholics for Choice, Feminist Majority Foundation, Center for Reproductive Rights, Ayn Rand Institute, Southern Poverty Law Center, Clinton Global Initiative, the Gay and Lesbian Alliance Against Defamation (GLAAD), and PETA.</s><s>Churches are not being given special treatment.</s></p><p><s>Start quote:</s></p><p><s>Churches are not being given special treatment.</s></p><p><s>End quote.</s></p><p><s>Second, the typical justification for the tax exemption is that such institutions provide vital charitable benefits to society.</s><s>While that is undoubtedly true, the benefits argument is not the strongest reason to support tax exemption.</s><s>A better reason is that we need to maintain a distinction between the state and the church.</s><s>As Richard W. Garnett—a law professor at the University of Notre Dame_explains, the separation of church and state is not a reason to invalidate or abandon these tax exemptions, but is instead a powerful justification for retaining them:</s></p><p><s>The point of church-state &quot;separation&quot; is not to create a religion-free public sphere.</s><s>It is, instead, to safeguard the fundamental right to religious freedom by imposing limits on the regulatory—and, yes, the taxing—powers of governments.</s><s>After all, as Daniel Webster famously argued in the Supreme Court (and the great Chief Justice John Marshall agreed), the power to tax involves the power to destroy, and so we have very good reasons for exercising that power with care—especially when it comes to religious institutions.</s></p><p><s><break time="1000ms" />Should LGBT Issues Trump Religious Liberty?<break time="1000ms" /></s></p><p><s>Indeed, the power of destruction through taxation is the reason O’Rourke and others are threatening to revoke tax exemption.</s><s>In 2005, Jonathan Turley, a law professor who supports LGBT rights,warned this would happen:</s></p><p><s>The debate over same-sex marriage represents a coalescing of rights of free exercise, free speech, and expressive association.</s><s>With the exception of abortion, same-sex marriage is almost unique in blurring neat divisions between these rights.</s><s>Many organizations attract members with their commitment to certain fundamental matters of faith or morals, including a rejection of same-sex marriage or homosexuality.</s><s>It is rather artificial to tell such groups that they can condemn homosexuality as long as they are willing to hire homosexuals as a part of that mission.</s><s>It is equally disingenuous to suggest that denial of such things as tax exemption does not constitute a content-based punishment for religious views.</s><s>.</s><s>.</s><s>.</s><s>The denial of tax-exempt status presents a particularly serious threat to these organizations and puts them at a comparative disadvantage to groups with contrary views.</s></p><p><s>When Turley made this claim 14 years ago, many assumed he was overstating the case.</s><s>Surely, same-sex marriage would not require people and organizations to give up their deeply held religious beliefs.</s><s>But now, as we’ve seen time and time again over the past few years, the threat to religious freedom is all too real.</s><s>What is significant about O’Rourke statement is not the novelty of the idea, but that the Democratic Party no longer believes it will be punished for being open about how LGBT issues trump religious liberty.</s></p><p><s>Start quote:</s></p><p><s>What’s significant about O’Rourke statement is not the novelty of the idea, but that the Democratic Party no longer believes it will be punished for being open about how LGBT issues trump religious liberty.</s></p><p><s>End quote.</s></p><p><s>Are supporters of same-sex marriage—including many misguided Christians—willing to let Christian high schools, colleges, seminaries, and churches be put out of business simply for holding a biblical view of marriage?</s></p><p><s>Sadly, I suspect they will follow what Rod Dreher calls the law of merited impossibility: &quot;It’s a complete absurdity to believe that Christians will suffer a single thing from the expansion of gay rights, and boy, do they deserve what they’re going to get.&quot;</s></p></speak>';

      const ssmlParts = getSSMLParts(largeExample, {
        hardLimit: GOOGLE_CHARACTER_HARD_LIMIT,
        softLimit: GOOGLE_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(3);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(GOOGLE_CHARACTER_HARD_LIMIT);
      })
    });

    it('Should generate the correct SSML parts for Google when using a very long SSML tag.', () => {
      // tslint:disable max-line-length
      const largeExample = `<speak><p><s>No-no to Reno and Beto.</s><break time="1000ms" /></p><p><s>Note: This is the G-File, Jonah Goldberg’s newsletter.</s><s>If you saw this without subscribing and want it in your inbox, sign up here.</s></p><p><s>Dear Reader (as well as those who opted to receive this &quot;news&quot;letter through long protein strings),</s></p><p><s>This is the first G-File of the new era.</s><s>I feel like I should be dressed all fancy and serve the good cheese.</s><s>You know the one that says cheese and not &quot;cheese product&quot; on the label.</s></p><p><s>What is this new era of which I speak?</s><s>Well, this &quot;news&quot;letter is now a product—some uncharitable souls might say the cheese product—of The Dispatch, the new media thingamabob I co-founded with Steve Hayes and Toby Stock.</s></p><p><s>The thing is, all of this high-minded stuff we talk about in our manifesto, the earnest lectures we give our young staffers about doing things the right way, our burning desire to push back on what social scientists call the garbageification of everything: Well, this &quot;news&quot;letter doesn’t quite mesh with all of that.</s><s>I mean, sometimes it does, but even back when I was at National Review, the G-File stuck out like a chimpanzee on a tricycle, dressed as Evel Knievel, in a performance of Swan Lake.</s><s>It’s sort of the curly fry that mysteriously ends up in the bag of normal fries.</s></p><p><s>So I’m worried that some of our new subscribers will read this &quot;news&quot;letter today and be like the Amish guy who mistakenly went into a BDSM sex shop because he thought all the whips, chaps, and saddles in the window meant it was an equestrian supply outlet.</s><s>&quot;Oh, no. I think I’m in the wrong place.&quot;</s></p><p><s>But as the cashier replied, &quot;Maybe not.</s><s>Give it a try.&quot;</s></p><p><s>True story: Back when the Obama White House completely botched the Obamacare website, I made a crack on Special Report about how none of us could have predicted that the administration would farm out the job to the best computer programmers the Amish community could offer.</s><s>My late friend Charles Krauthammer pretended to take great offense on behalf of the Amish, saying something like, &quot;I won’t stay silent as Jonah besmirches the good name of Amish Americans.&quot; I shot back, &quot;Why bother Charles?</s><s>It’s not like they’re watching.&quot;</s></p><p><s>That total non-sequitur raises another issue.</s><s>The G-File is as much a dessert topping as it is a floor wax, by which I mean it’s whatever I want it to be.</s><s>I completely understand that it’s an acquired taste and some people don’t like it (after all, there are actually people who like flan).</s><s>As my old boss Bill Buckley liked to say: &quot;Pass the peanut butter and bacon canapes.&quot; People would then say &quot;How can you eat that?&quot; To which he’d respond, &quot;De gustibus non est disputandum,&quot; which means: &quot;In matters of taste there can be no dispute.&quot;</s></p><p><s>As I explained years ago, the dashboard saint of this &quot;news&quot;letter is the gnostic theologian Joachim of Fiore.</s><s>I kid, I kid; this &quot;news&quot;letter is a No Immanentizing the Eschaton Zone.</s><s>The real dashboard saint is Dr. Johnny Fever, the DJ from WKRP in Cincinnati, whose career was almost destroyed because he once said &quot;booger&quot; on the air.</s><s>When Andy Travis, the new station manager, took over WKRP, he told Johnny he could say &quot;booger,&quot; by which he meant he could do whatever he wanted.</s><s>At National Review, my friend Rich Lowry was my Andy Travis.</s><s>Now, because I’m the editor-in-chief of The Dispatch, I’m my own Andy Travis.</s><s>Ergo, &quot;Booger.&quot;</s></p><p><s>Post-Liberalism Is a Power Grab</s></p><p><s>I should probably stop the narcissistic and self-congratulatory stream of consciousness.</s><s>After all, this isn’t a Trump rally.</s></p><p><s>Earlier this week, the American Enterprise Institute held a panel on the role of conservative magazines, with the editors of National Review (Lowry), Commentary (John Podhoretz) and First Things (R.R. &quot;Rusty&quot; Reno), and moderated by Yuval Levin, the editor of National Affairs and—little known fact—perhaps the world’s foremost punk rock bagpiper.</s></p><p><s>I couldn’t attend, but I was amused to hear about Reno’s contributions.</s><s>Reno is one of the boosters of this idea that the old conservative consensus is not only dead—possibly true—but that we should all dance on its grave (Yuval could play &quot;Anarchy in the UK&quot; on the grave-turned-mosh-pit).</s><s>That consensus, he argues, needs to be replaced by a new nationalist or post-liberal or Catholic integralist philosophy.</s><s>The mere fact that the champions of this &quot;movement&quot; can’t agree on what to call it—never mind what it should do—should indicate how confused the whole thing is.</s><s>Though I suppose they’d call it a healthy sign of intellectual ferment.</s><s>I think it’s more like a half-dozen eggheads not merely bickering over where they should go, but slap-fighting over the steering wheel and who should be in the driver’s seat.</s></p><p><s>Of my myriad problems with this new idea is that it’s not new.</s><s>Shorn of its grandiose verbiage and tough guy rhetoric (they invest vast amounts of moral and philosophic urgency in the idea that &quot;fighting&quot; is self-justifying and, like, really, cool), their idea is literally one of the oldest ideas in the history, and pre-history, of politics: Our side should be in charge and have its way.</s><s>What they often dismiss as &quot;procedural liberalism&quot;—i</s><s>e., free speech, individual rights, property rights, etc.—are simply hindrances to doing what is right, by which they mean imposing some notion of the Highest Good.</s><s>In other words, liberty isn’t a good in itself; it is, at best, a means to do good things, and if it doesn’t serve that function, it is a problem.</s></p><p><s>It’s very similar to Tucker Carlson’s claim that &quot;the market is just a tool.&quot; I have no problem with the idea that the market is a tool, because it is.</s><s>As Hayek argued, it is a process of discovery that allows us to find the price of goods and services as well as greater efficiencies in distributing resources.</s></p><p><s>My objection is with the word &quot;just.&quot; The market is a tool, but it’s not merely a tool.</s><s>Economic liberty is a facet of liberty generally, and liberty isn’t merely a tool; it’s a right and an ideal.</s><s>Plenty of &quot;tools&quot; are the way we operationalize our rights and ideals.</s><s>Guns are tools, but self-defense is a right.</s><s>The printing press and the internet are tools, but free speech is a right.</s><s>Churches serve a utilitarian function, but faith and the right to exercise it is more than just another way to spend your time.</s></p><p><s>Now, it is entirely fair to point out that the Founders saw a lot of utility in procedural liberalism.</s><s>The new science of politics they lay out in the Federalist Papers is deeply practical.</s><s>The checks and balances, the pitting of factions against each other, is a very utilitarian affair on one level.</s><s>But their means and ends were properly aligned.</s><s>The means of procedural liberalism were intended to protect the purpose of the republic they established: Liberty.</s></p><p><s>Because Reno &amp; co.</s><s>reject this purpose, they reject the means as a hindrance to their agenda.</s><s>Again, this isn’t a new idea.</s><s>The notion that my team should be in charge and use the state to make others live the way my team wants them to live may literally be the oldest understanding of politics that has ever existed.</s><s>Ancient kings and emperors believed it.</s><s>Opponents of the Enlightenment believed it.</s><s>The totalitarians of the 20th century believed it.</s><s>The technocrats of the Progressive Era and the New Deal believed it (which explains why Reno gets so offended when people criticize Wilson and FDR).</s></p><p><s>Yet what is remarkable about their project isn’t the grandness of their indictment but the smallness of their agenda.</s><s>When talking at the theoretical level, they sound like Zeus bellowing at the folly of the mortals, hurling rhetorical lightning bolts.</s><s>But when they climb down from Mt.</s><s>Olympus, the courage of their convictions barely has the spark of a Bic lighter.</s><s>In the famous debate between my soon-to-be Dispatch colleague David French and Sohrab Amari, David French kept asking what a real fighting post-liberal would actually do to fight, among other things, the scourge of drag queen story hours in a handful of libraries.</s><s>His answer: Have senators Josh Hawley and Ted Cruz grill the head of the American Library Association.</s><s>Put aside the fact that there is nothing inherent to the liberal order preventing such a bold move right now.</s><s>Let’s pretend it were otherwise.</s><s>For this we’re supposed to dustbin liberty as an ideal?</s><s>I mean, at least Richard Rich got Wales in A Man for All Seasons.</s><s>As for Reno, one of his treasured policy goals—apparently impossible under the Ancien Regime of the old conservative consensus—is mandatory ballroom dancing lessons.</s><s>Paging Sean Spicer: Your nation needs your service once more, not as a mere professional crowd size exaggerator but as the new Ballroom Dancing Czar.</s></p><p><s>The Intellectual Fecundity of Decadence</s></p><p><s>Anyway, back to that panel.</s><s>&quot;I doubt [Donald Trump] used the word ‘freedom’ a single time in his [RNC] convention speech,&quot; Reno mused approvingly.</s><s>&quot;And his themes are ones of protection and solidarity, I would say.&quot; (I checked: Trump did use the word freedom once, but in the context of better trade deals.</s><s>He didn’t say &quot;liberty&quot; at all.</s><s>He also described America as a violence-soaked hellscape, which is apparently unobjectionable in the name of solidarity.)</s></p><p><s>For Reno, excising freedom from conservative rhetoric is a good thing because &quot;we need a politics of what I would call cultural solidarity.&quot; To that end, he would punitively tax divorce—because you know divorce is free of financial costs under a regime of procedural liberalism.</s><s>His other idea would be to put a lifetime cap of $1 billion on philanthropic donations.</s></p><p><s>Why prevent rich people from giving more money to charities (including, presumably the Catholic Church)?</s><s>Well, among reasons, it is apparently a shock to the nationalist conscience that a private philanthropy, the Gates Foundation, in Reno’s words, &quot;effectively runs health policy for most of Africa.</s><s>And people say, ‘Well, they do a better job than the governments of those countries would.’ You know, but at some point I say, ‘Fuck you, I wanna run my own goddamn country.’&quot;</s></p><p><s>He later apologized for his profanity, but I found this particularly amusing for several reasons.</s><s>Reno and his compatriots have tried very hard to paint their opponents as morally deficient.</s><s>Reno’s First Things colleague Matthew Schmitz pilloried David French—a devout Christian—for watching Game of Thrones because there are too many boobies in it.</s><s>French’s defense of the First Amendment and religious liberty is really proof of his &quot;moral relativism,&quot; argue his critics.</s><s>In a broadside against me for daring to write a book that defends liberty and the market, Reno—who cannot muster much passion about the sybaritic lifestyle and thuggish rhetoric of Donald Trump and his praetorians—wrote: &quot;Jonah Goldberg exemplifies the decadence and dysfunction of today’s public discourse.&quot;</s></p><p><s>Look, I’m just a scribbler who wants the freedom to say &quot;booger&quot; in my &quot;news&quot;letter.</s><s>But I think it’s just hilarious that the champion of Catholic-infused nationalism thinks the place to drop the pretense of probity and starting dropping F-Bombs is on the issue of billionaires spending their own money to…[checks notes]…save the lives of millions of poor African children.</s></p><p><s>The Left’s Cultural Solidarity</s></p><p><s>While I don’t take Reno very seriously, the movement he exemplifies is a serious thing, because if it succeeds in convincing conservatives that liberty—both as a system and an end—is no longer worth fighting for, then that will leave the whole of the fight to libertarians and a remnant of classical liberals.</s></p><p><s>And let’s be clear, they may be dangerously wrong in wanting to fight the statism of the left with a statism of the right, but the post-liberals are on much stronger footing in opposing the statism of the left.</s><s>Consider Beto O’Rourke, who seems to think that the shortest path to the Oval Office is to become a hipster Noam Chomsky.</s><s>Last night, he said he wants to revoke the tax exempt status of any church that doesn’t perform same-sex marriages:</s></p><p><s>Start quote:</s></p><p><s>There can be no reward, no benefit, no tax break, for anyone or any institution, any organization in America that denies the full human rights and the full civil rights of every single one of us.</s><s>And so, as president, we’re going to make that a priority, and we are going to stop those who are infringing upon the human rights of our fellow Americans.</s></p><p><s>End quote.</s></p><p><s>If I were of a more QAnony bent, I would suspect that O’Rourke is a Russian sleeper agent determined to sow social discord by serving as a right-wing strawman made flesh.</s><s>Or maybe he’s a kind of strawman golem?</s><s>If enough liberals say, &quot;Oh come on, that’s not what liberals actually believe!&quot; a straw Beto O’Rourke suddenly comes to life:</s></p><p><s>Start quote:</s></p><p><s>&quot;Liberals don’t want to confiscate everyone’s guns!&quot;</s></p><p><s>[Sproing!] &quot;Hi, I’m Beto O’Rourke.</s><s>We’re gonna get the guns.&quot;</s></p><p><s>&quot;Um, why are you standing on my table?&quot;</s></p><p><s>&quot;No liberal thinks the government should force the Catholic Church or Orthodox Jews or devout Muslims to perform same sex weddings!</s><s>That’s just a strawman.&quot;</s></p><p><s>[Sproing] &quot;I’m not straw!</s><s>I’m a real boy!&quot;</s></p><p><s>End quote.</s></p><p><s>But here’s the thing: Beto and Reno have a lot in common.</s><s>They both reject &quot;procedural liberalism,&quot; if procedural liberalism stands in the way of their definition of &quot;cultural solidarity.&quot; They just disagree on what that cultural solidarity should look like.</s></p><p><s>And once you do away with the safeguards of procedural liberalism—and the ideal of liberty itself—the only way to determine whose vision will win out is a raw contest of power.</s><s>Under a liberal regime, one with the law on his side is a majority, in the words of Calvin Coolidge.</s><s>Under a post-liberal regime, the law is whatever the majority can get away with.</s><s>As a conservative, and if forced to choose, I think I’d rather live in Reno’s vision of a post-liberal society than Beto’s—I like ballroom dancing—but even if his team could succeed in getting power, I have little doubt it would be a temporary victory, won at the expense of tearing down the safeguards that prevent the kind of victory Beto is proposing.</s><s>And as a conservative, I’d rather conserve the safeguards.</s></p><p><s>Various &amp; Sundry</s></p><p><s>Canine Update, Explained: So I was going to do a long primer on the G-File for the uninitiated, but the open felt too self-indulgent and the rest got away from me like Joe Biden trying to tell a short anecdote.</s><s>Besides, maybe it’s better to show rather than tell.</s><s>Regardless, one of the features of every G-File is a &quot;canine update&quot; about my dogs Zoë and Pippa.</s><s>Zoë is a Carolina dog, a.k.a. the American Dingo, and is a serious predator and something of a white trash swamp dog.</s><s>Pippa is an English springer spaniel, and a lover not a fighter.</s><s>As I often say, Zoë is like Daryl from The Walking Dead, happy to cull squirrels for lunch, and Pippa is more like one of the dumber and prettier daughters from Downtown Abbey, if one of the hallmarks of the English aristocracy were chasing tennis balls.</s></p><p><s>Canine Update: Zoë and Pippa are doing very well.</s><s>The fall weather is finally truly here and they are all for it.</s><s>Pippa’s trademark waggle is fully functional.</s><s>But her limp seems to come back every now and then, mostly because she’s been overdoing it thanks to the weather.</s><s>She’s also feeling a little superior these days; she even took the Zoë’s wing-dog seat the other day.</s><s>Alas, the only exciting event this week has no video attached.</s><s>I was walking the beasts around the neighborhood the other evening—Zoë on leash as is required because, like the Crips and Bloods, she’s so territorial about her streets—and Zoë seemed super excited about something in some very tall hedges.</s><s>I assumed she spotted a rabbit or squirrel and gave her a little slack in the leash to check it out.</s><s>She barreled into the hedges and a giant buck exploded out and ran right past me.</s><s>Scared the crap out of me—figuratively speaking.</s></p><p><s>ICYMI…</s></p><p><s>My Monday NPR hit</s></p><p><s>This week&apos;s first Remnant, and the first Dispatch Remnant, with Steve Hayes</s></p><p><s>Trump puts Republican senators in a bind</s></p><p><s>This week&apos;s second Remnant, with/about Big Mo</s></p><p><s>This week&apos;s GLoP</s></p><p><s>On the NBA&apos;s China cowardice</s></p><p><s>And now, the weird stuff.</s></p><p><s>Acoustic mysteries</s></p><p><s>Prison economies</s></p><p><s>Unexpected python</s></p><p><s>A good dog</s></p><p><s>A Florida Man</s></p><p><s>Batman...?</s></p><p><s>What a headline</s></p><p><s>Prison break</s></p><p><s>Holy rollers</s></p></speak>`

      const ssmlParts = getSSMLParts(largeExample, {
        hardLimit: GOOGLE_CHARACTER_HARD_LIMIT,
        softLimit: GOOGLE_CHARACTER_SOFT_LIMIT
      });

      expect(ssmlParts).toHaveLength(5);

      ssmlParts.forEach(ssmlPart => {
        expect(ssmlPart.length).toBeLessThan(GOOGLE_CHARACTER_HARD_LIMIT);
      })
    });
  });

});
